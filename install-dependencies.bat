@echo off
chcp 65001 >nul
title –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
color 0E

echo ========================================
echo   –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –ø—Ä–æ–µ–∫—Ç–∞
echo ========================================
echo.

:: –ü—Ä–æ–≤–µ—Ä–∫–∞ Node.js
where node >nul 2>nul
if %ERRORLEVEL% NEQ 0 (
    color 0C
    echo ‚ùå –û–®–ò–ë–ö–ê: Node.js –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!
    echo.
    echo –°–∫–∞—á–∞–π—Ç–µ –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Node.js:
    echo https://nodejs.org/
    echo.
    pause
    exit /b 1
)

:: –í—ã–≤–æ–¥ –≤–µ—Ä—Å–∏–π
echo üìã –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∏—Å—Ç–µ–º–µ:
node --version
npm --version
echo.

:: –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
if exist "node_modules\" (
    echo ‚ö† –ù–∞–π–¥–µ–Ω–∞ —Å—Ç–∞—Ä–∞—è –ø–∞–ø–∫–∞ node_modules
    choice /C YN /M "–£–¥–∞–ª–∏—Ç—å –µ—ë –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–Ω–æ–≤–æ"
    if errorlevel 2 goto :skip_clean
    if errorlevel 1 (
        echo üóë –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π...
        rmdir /s /q "node_modules"
        if exist "package-lock.json" del /q "package-lock.json"
        echo ‚úÖ –û—á–∏—Å—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞
        echo.
    )
)
:skip_clean

:: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
echo üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –∏–∑ package.json...
echo –≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç...
echo.

call npm install

if %ERRORLEVEL% EQU 0 (
    color 0A
    echo.
    echo ========================================
    echo   ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!
    echo ========================================
    echo.
    echo –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –ø–∞–∫–µ—Ç—ã:
    call npm list --depth=0
    echo.
    echo –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä —á–µ—Ä–µ–∑:
    echo start-server.bat
) else (
    color 0C
    echo.
    echo ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π!
    echo.
    echo –ü–æ–ø—Ä–æ–±—É–π—Ç–µ:
    echo 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É
    echo 2. –û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à npm: npm cache clean --force
    echo 3. –û–±–Ω–æ–≤–∏—Ç—å npm: npm install -g npm
)

echo.
pause

