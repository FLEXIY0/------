<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KINOTEKA</title>
    <link rel="icon" type="image/png" href="logo.png">
    <link rel="stylesheet" href="theme-manager.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Quicksand:wght@300;400;500;600;700&family=Nunito:wght@300;400;500;600;700&family=Roboto:wght@300;400;500;700&family=Open+Sans:wght@300;400;600;700&family=Lato:wght@300;400;700&family=Poppins:wght@300;400;500;600;700&family=Montserrat:wght@300;400;500;600;700&family=Source+Sans+Pro:wght@300;400;600;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: "Nunito", sans-serif;
            background: var(--bg-primary, #141414);
            color: var(--text-secondary, #9E9E9E);
            min-height: 100vh;
            padding: 20px;
            color-scheme: dark;
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 20px;
        }

        .main-section {
            width: 100%;
        }

        .preview-placeholder {
            position: sticky;
            top: 20px;
            height: calc(100vh - 40px);
            background: var(--bg-secondary, #212121);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-muted, #666);
            font-size: 14px;
            text-align: center;
            padding: 20px;
        }

        .header {
            display: none; /* –í—Ä–µ–º–µ–Ω–Ω–æ —Å–∫—Ä—ã—Ç - –º–æ–∂–Ω–æ –≤–∫–ª—é—á–∏—Ç—å –∏–∑–º–µ–Ω–∏–≤ –Ω–∞ "flex" */
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
            background: var(--bg-secondary, #212121);
            padding: 15px 20px;
            border-radius: 12px;
        }

        .back-button {
            width: 50px;
            height: 50px;
            background: var(--bg-accent, #3e3e3e);
            border: none;
            border-radius: 8px;
            color: var(--text-secondary, #9E9E9E);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .back-button:hover {
            background: var(--bg-hover, #323232);
        }

        .back-button .material-symbols-outlined {
            font-size: 24px;
            font-variation-settings:
                'FILL' 1,
                'wght' 600,
                'GRAD' 0,
                'opsz' 24;
        }

        h1 {
            flex: 1;
            color: var(--text-primary, #B8B8B8);
            font-size: 24px;
            font-weight: 600;
            text-align: center;
        }

        /* –ü–∞–Ω–µ–ª—å —Ñ–∏–ª—å—Ç—Ä–æ–≤ */
        .filter-panel {
            background: var(--bg-secondary, #212121);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .filters-compact {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-toggle {
            padding: 10px 16px;
            background: var(--bg-tertiary, #2a2a2a);
            border: 2px solid transparent;
            border-radius: 8px;
            color: var(--text-secondary, #9E9E9E);
            font-size: 13px;
            font-family: "Nunito", sans-serif;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .filter-toggle:hover {
            background: var(--bg-accent, #3e3e3e);
            color: var(--text-primary, #B8B8B8);
        }

        .filter-toggle.active {
            background: var(--bg-accent, #3e3e3e);
            border-color: var(--star-filled, #ffcc80);
            color: var(--text-primary, #B8B8B8);
        }

        .filter-toggle .material-symbols-outlined {
            font-size: 18px;
        }

        .filter-badge {
            background: var(--star-filled, #ffcc80);
            color: var(--bg-primary, #141414);
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 11px;
            font-weight: 600;
        }

        .filter-expanded {
            margin-top: 15px;
            padding: 15px;
            background: var(--bg-primary, #1a1a1a);
            border-radius: 8px;
            display: none;
        }

        .filter-expanded.show {
            display: block;
        }

        .filter-expanded-title {
            color: var(--text-primary, #B8B8B8);
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .filter-close {
            color: var(--text-muted, #666);
            cursor: pointer;
            font-size: 20px;
            transition: color 0.2s;
        }

        .filter-close:hover {
            color: var(--text-secondary, #9E9E9E);
        }

        /* –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —Ä–µ–π—Ç–∏–Ω–≥—É */
        .rating-sort {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .rating-sort-btn {
            flex: 1;
            padding: 10px;
            background: var(--bg-tertiary, #2a2a2a);
            border: 2px solid transparent;
            border-radius: 8px;
            color: var(--text-secondary, #9E9E9E);
            font-size: 13px;
            font-family: "Nunito", sans-serif;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }

        .rating-sort-btn:hover {
            background: var(--bg-accent, #3e3e3e);
        }

        .rating-sort-btn.active {
            background: var(--bg-accent, #3e3e3e);
            border-color: var(--star-filled, #ffcc80);
            color: var(--text-primary, #B8B8B8);
        }

        .rating-sort-btn .material-symbols-outlined {
            font-size: 18px;
        }

        /* –§–∏–ª—å—Ç—Ä –ø–æ –∑–≤–µ–∑–¥–∞–º */
        .stars-filter {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .stars-filter-label {
            color: var(--text-secondary, #9E9E9E);
            font-size: 12px;
            margin-bottom: 5px;
        }

        .stars-row {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .star-btn {
            background: none;
            border: none;
            color: var(--star-empty, #4a4a4a);
            font-size: 28px;
            cursor: pointer;
            transition: all 0.2s ease;
            padding: 0;
            line-height: 1;
        }

        .star-btn:hover {
            color: var(--star-filled, #ffcc80);
            transform: scale(1.1);
        }

        .star-btn.active {
            color: var(--star-filled, #ffcc80);
        }

        .star-btn.selected {
            color: var(--star-filled, #ffcc80);
        }

        .clear-stars {
            padding: 6px 12px;
            background: var(--bg-tertiary, #2a2a2a);
            border: none;
            border-radius: 6px;
            color: var(--text-secondary, #9E9E9E);
            font-size: 11px;
            font-family: "Nunito", sans-serif;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .clear-stars:hover {
            background: var(--bg-accent, #3e3e3e);
        }

        /* –°–∫—Ä—ã—Ç—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã */
        .hidden-filters-btn {
            padding: 10px 16px;
            background: var(--bg-tertiary, #2a2a2a);
            border: 2px solid transparent;
            border-radius: 8px;
            color: var(--text-secondary, #9E9E9E);
            font-size: 13px;
            font-family: "Nunito", sans-serif;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .hidden-filters-btn:hover {
            background: var(--bg-accent, #3e3e3e);
            color: var(--text-primary, #B8B8B8);
        }

        .hidden-filters-btn.active {
            background: var(--bg-accent, #3e3e3e);
            border-color: var(--star-filled, #ffcc80);
            color: var(--text-primary, #B8B8B8);
        }

        .hidden-filters-btn .material-symbols-outlined {
            font-size: 18px;
        }

        .hidden-filters-panel {
            margin-top: 15px;
            padding: 15px;
            background: var(--bg-primary, #1a1a1a);
            border-radius: 8px;
            display: none;
        }

        .hidden-filters-panel.show {
            display: block;
        }

        .hidden-filter-group {
            margin-bottom: 15px;
        }

        .hidden-filter-group:last-child {
            margin-bottom: 0;
        }

        .hidden-filter-label {
            color: var(--text-primary, #B8B8B8);
            font-size: 12px;
            font-weight: 500;
            margin-bottom: 8px;
            display: block;
        }

        .hidden-filter-options {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .hidden-filter-option {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px;
            background: var(--bg-tertiary, #2a2a2a);
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .hidden-filter-option:hover {
            background: var(--bg-accent, #3e3e3e);
        }

        .hidden-filter-option.selected {
            background: var(--bg-accent, #3e3e3e);
        }

        .hidden-filter-checkbox {
            width: 16px;
            height: 16px;
            background: var(--bg-primary, #141414);
            border: 2px solid var(--star-empty, #4a4a4a);
            border-radius: 3px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--star-filled, #ffcc80);
            font-size: 12px;
        }

        .hidden-filter-option.selected .hidden-filter-checkbox {
            border-color: var(--star-filled, #ffcc80);
        }

        .hidden-filter-text {
            color: var(--text-secondary, #9E9E9E);
            font-size: 13px;
        }

        .hidden-filter-option.selected .hidden-filter-text {
            color: var(--text-primary, #B8B8B8);
        }

        /* Range slider –¥–ª—è –≥–æ–¥–∞ */
        .year-range-container {
            padding: 10px 0;
        }

        .year-values {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            color: var(--text-primary, #B8B8B8);
            font-size: 13px;
        }

        .year-slider {
            position: relative;
            height: 6px;
            background: var(--bg-tertiary, #2a2a2a);
            border-radius: 3px;
        }

        .year-slider-track {
            position: absolute;
            height: 100%;
            background: var(--star-filled, #ffcc80);
            border-radius: 3px;
        }

        .year-input {
            position: absolute;
            width: 100%;
            height: 6px;
            background: transparent;
            pointer-events: none;
            -webkit-appearance: none;
            top: 0;
        }

        .year-input::-webkit-slider-thumb {
            -webkit-appearance: none;
            pointer-events: all;
            width: 16px;
            height: 16px;
            background: var(--star-filled, #ffcc80);
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid var(--bg-primary, #141414);
        }

        .year-input::-moz-range-thumb {
            pointer-events: all;
            width: 16px;
            height: 16px;
            background: var(--star-filled, #ffcc80);
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid var(--bg-primary, #141414);
        }

        /* –í—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫ —Å —á–µ–∫–±–æ–∫—Å–∞–º–∏ */
        .dropdown {
            position: relative;
        }

        .dropdown-trigger {
            width: 100%;
            padding: 10px 12px;
            background: var(--bg-tertiary, #2a2a2a);
            border: 2px solid transparent;
            border-radius: 8px;
            color: var(--text-secondary, #9E9E9E);
            font-size: 13px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .dropdown-trigger:hover {
            background: var(--bg-accent, #3e3e3e);
        }

        .dropdown-trigger.active {
            border-color: var(--star-filled, #ffcc80);
            background: var(--bg-accent, #3e3e3e);
        }

        .dropdown-content {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            margin-top: 5px;
            background: var(--bg-tertiary, #2a2a2a);
            border-radius: 8px;
            max-height: 250px;
            overflow-y: auto;
            z-index: 100;
            display: none;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
        }

        .dropdown-content.show {
            display: block;
        }

        .dropdown-item {
            padding: 10px 12px;
            cursor: pointer;
            transition: background 0.2s;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .dropdown-item:hover {
            background: var(--bg-accent, #3e3e3e);
        }

        .dropdown-checkbox {
            width: 18px;
            height: 18px;
            background: var(--bg-primary, #141414);
            border: 2px solid var(--star-empty, #4a4a4a);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--star-filled, #ffcc80);
            font-size: 14px;
        }

        .dropdown-item.selected .dropdown-checkbox {
            border-color: var(--star-filled, #ffcc80);
        }

        .dropdown-item-label {
            color: var(--text-secondary, #9E9E9E);
            font-size: 13px;
        }

        .dropdown-item.selected .dropdown-item-label {
            color: var(--text-primary, #B8B8B8);
        }

        /* –ü–æ–∏—Å–∫ —Ä–µ–∂–∏—Å—Å–µ—Ä–∞ */
        .search-dropdown {
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 10px 12px;
            background: var(--bg-tertiary, #2a2a2a);
            border: 2px solid transparent;
            border-radius: 8px;
            color: var(--text-primary, #B8B8B8);
            font-size: 13px;
            font-family: "Nunito", sans-serif;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--star-filled, #ffcc80);
            background: var(--bg-accent, #3e3e3e);
        }

        .search-input::placeholder {
            color: var(--text-muted, #666);
        }

        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            margin-top: 5px;
            background: var(--bg-tertiary, #2a2a2a);
            border-radius: 8px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 100;
            display: none;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
        }

        .search-results.show {
            display: block;
        }

        .search-result-item {
            padding: 10px 12px;
            cursor: pointer;
            color: var(--text-secondary, #9E9E9E);
            font-size: 13px;
            transition: background 0.2s;
        }

        .search-result-item:hover {
            background: var(--bg-accent, #3e3e3e);
            color: var(--text-primary, #B8B8B8);
        }

        .search-result-item.selected {
            background: var(--bg-accent, #3e3e3e);
            color: var(--star-filled, #ffcc80);
        }

        .clear-filters-btn {
            padding: 10px 16px;
            background: var(--bg-tertiary, #2a2a2a);
            border: none;
            border-radius: 8px;
            color: var(--text-secondary, #9E9E9E);
            font-size: 13px;
            font-family: "Nunito", sans-serif;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .clear-filters-btn:hover {
            background: var(--bg-accent, #3e3e3e);
            color: var(--text-primary, #B8B8B8);
        }

        .clear-filters-btn .material-symbols-outlined {
            font-size: 18px;
        }

        /* –¢–∞–±–ª–∏—Ü–∞ */
        .table-container {
            background: var(--bg-secondary, #212121);
            border-radius: 12px;
            overflow: hidden;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: var(--bg-tertiary, #2a2a2a);
        }

        th {
            padding: 15px;
            text-align: left;
            color: var(--text-primary, #B8B8B8);
            font-size: 13px;
            font-weight: 600;
            border-bottom: 2px solid var(--bg-primary, #141414);
        }

        th:first-child {
            width: 50px;
            text-align: center;
        }

        .toggle-panel-btn {
            background: none;
            border: none;
            color: var(--text-muted, #666);
            cursor: pointer;
            font-size: 18px;
            padding: 0;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .toggle-panel-btn:hover {
            color: var(--text-primary, #B8B8B8);
            transform: scale(1.2);
        }

        .toggle-panel-btn .material-symbols-outlined {
            font-size: 20px;
            transition: transform 0.3s ease;
        }

        .filter-panel.hidden {
            display: none;
        }

        tbody tr {
            border-bottom: 1px solid var(--bg-tertiary, #2a2a2a);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        tbody tr:hover {
            background: var(--bg-tertiary, #2a2a2a);
        }

        tbody tr.active {
            background: var(--bg-accent, #3e3e3e);
        }

        td {
            padding: 15px;
            color: var(--text-secondary, #9E9E9E);
            font-size: 14px;
        }

        td:first-child {
            text-align: center;
            color: var(--text-primary, #B8B8B8);
            font-weight: 600;
        }

        .rating-cell {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .rating-stars {
            color: var(--star-filled, #ffcc80);
            font-size: 16px;
        }

        .rating-value {
            color: var(--text-primary, #B8B8B8);
            font-weight: 600;
        }

        /* –ü—Ä–µ–≤—å—é –∫–∞—Ä—Ç–æ—á–∫–∞ */
        .preview-card {
            position: sticky;
            top: 20px;
            width: 100%;
            height: calc(100vh - 40px);
            background: var(--bg-secondary, #212121);
            border-radius: 12px;
            padding: 20px;
            overflow-y: auto;
            display: none;
        }

        .preview-card.show {
            display: block;
        }

        .preview-placeholder.hide {
            display: none;
        }

        .preview-poster {
            width: 100%;
            aspect-ratio: 2/3;
            background: var(--bg-tertiary, #2a2a2a);
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 15px;
        }

        .preview-poster img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .preview-title {
            color: var(--text-primary, #B8B8B8);
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .preview-rating {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .preview-stars {
            color: var(--star-filled, #ffcc80);
            font-size: 18px;
        }

        .preview-info {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .preview-info-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #2a2a2a;
        }

        .preview-info-label {
            color: #888;
            font-size: 12px;
        }

        .preview-info-value {
            color: var(--text-primary, #B8B8B8);
            font-size: 13px;
            font-weight: 500;
            text-align: right;
        }

        .preview-description {
            margin-top: 15px;
            color: var(--text-secondary, #9E9E9E);
            font-size: 13px;
            line-height: 1.6;
        }

        .preview-action {
            margin-top: 15px;
            width: 100%;
            padding: 12px;
            background: var(--bg-accent, #3e3e3e);
            border: none;
            border-radius: 8px;
            color: var(--text-primary, #B8B8B8);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .preview-action:hover {
            background: #4a4a4a;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-muted, #666);
        }

        .empty-state .material-symbols-outlined {
            font-size: 80px;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        .empty-state-text {
            font-size: 18px;
            margin-bottom: 10px;
        }

        .empty-state-hint {
            font-size: 14px;
            color: #555;
        }

        /* –°–∫—Ä–æ–ª–ª–±–∞—Ä—ã */
        .preview-card::-webkit-scrollbar,
        .dropdown-content::-webkit-scrollbar,
        .search-results::-webkit-scrollbar {
            width: 8px;
        }

        .preview-card::-webkit-scrollbar-track,
        .dropdown-content::-webkit-scrollbar-track,
        .search-results::-webkit-scrollbar-track {
            background: var(--bg-tertiary, #2a2a2a);
            border-radius: 4px;
        }

        .preview-card::-webkit-scrollbar-thumb,
        .dropdown-content::-webkit-scrollbar-thumb,
        .search-results::-webkit-scrollbar-thumb {
            background: var(--bg-accent, #3e3e3e);
            border-radius: 4px;
        }

        .preview-card::-webkit-scrollbar-thumb:hover,
        .dropdown-content::-webkit-scrollbar-thumb:hover,
        .search-results::-webkit-scrollbar-thumb:hover {
            background: #4a4a4a;
        }
    </style>
</head>
<body>
    <div class="container" id="container">
        <div class="main-section">
            <div class="header">
                <button class="back-button" onclick="goBack()">
                    <span class="material-symbols-outlined">arrow_back</span>
                </button>
                <h1 id="pageTitle">–û–±—â–∏–π —Å–ø–∏—Å–æ–∫</h1>
            </div>

            <!-- –ü–∞–Ω–µ–ª—å —Ñ–∏–ª—å—Ç—Ä–æ–≤ -->
            <div class="filter-panel">
                <!-- –ö–æ–º–ø–∞–∫—Ç–Ω—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ -->
                <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                    <button class="back-button" onclick="goBack()" style="margin: 0;">
                        <span class="material-symbols-outlined">arrow_back</span>
                    </button>
                    <h2 id="pageTitle2" style="color: #B8B8B8; font-size: 18px; font-weight: 600; margin: 0; flex: 1;">–û–±—â–∏–π —Å–ø–∏—Å–æ–∫</h2>
                    <button class="back-button" onclick="createNewFilm()" style="margin: 0;" title="–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∫–∞—Ä—Ç–æ—á–∫—É">
                        <span class="material-symbols-outlined">add</span>
                    </button>
                </div>
                <!-- –ö–æ–º–ø–∞–∫—Ç–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤ -->
                <div class="filters-compact">
                    <button class="hidden-filters-btn" id="toggleHiddenFilters">
                        <span class="material-symbols-outlined">visibility_off</span>
                        <span class="filter-badge" id="hiddenFiltersBadge" style="display: none;">0</span>
                    </button>
                    <button class="filter-toggle" id="toggleRating">
                        <span class="material-symbols-outlined">star</span>
                        <span>–†–µ–π—Ç–∏–Ω–≥</span>
                    </button>
                    <button class="filter-toggle" id="toggleYear">
                        <span class="material-symbols-outlined">calendar_month</span>
                        <span>–ì–æ–¥</span>
                    </button>
                    <button class="filter-toggle" id="toggleCountry">
                        <span class="material-symbols-outlined">public</span>
                        <span>–°—Ç—Ä–∞–Ω–∞</span>
                        <span class="filter-badge" id="countryBadge" style="display: none;">0</span>
                    </button>
                    <button class="filter-toggle" id="toggleDirector">
                        <span class="material-symbols-outlined">person</span>
                        <span>–†–µ–∂–∏—Å—Å–µ—Ä</span>
                    </button>
                    <button class="filter-toggle" id="toggleGenre">
                        <span class="material-symbols-outlined">movie</span>
                        <span>–ñ–∞–Ω—Ä—ã</span>
                        <span class="filter-badge" id="genreBadge" style="display: none;">0</span>
                    </button>
                    <button class="clear-filters-btn" onclick="clearAllFilters()">
                        <span class="material-symbols-outlined">refresh</span>
                    </button>
                </div>

                <!-- –°–∫—Ä—ã—Ç—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã -->
                <div class="hidden-filters-panel" id="hiddenFiltersPanel">
                    <div class="hidden-filter-group">
                        <span class="hidden-filter-label">–¢–∏–ø –∫–æ–Ω—Ç–µ–Ω—Ç–∞</span>
                        <div class="hidden-filter-options">
                            <div class="hidden-filter-option" data-type="movie">
                                <div class="hidden-filter-checkbox"></div>
                                <div class="hidden-filter-text">–§–∏–ª—å–º</div>
                            </div>
                            <div class="hidden-filter-option" data-type="series">
                                <div class="hidden-filter-checkbox"></div>
                                <div class="hidden-filter-text">–°–µ—Ä–∏–∞–ª</div>
                            </div>
                        </div>
                    </div>
                    <div class="hidden-filter-group">
                        <span class="hidden-filter-label">–°—Ç–∞—Ç—É—Å –ø—Ä–æ—Å–º–æ—Ç—Ä–∞</span>
                        <div class="hidden-filter-options">
                            <div class="hidden-filter-option" data-status="watched">
                                <div class="hidden-filter-checkbox"></div>
                                <div class="hidden-filter-text">–ü—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–æ</div>
                            </div>
                            <div class="hidden-filter-option" data-status="watching">
                                <div class="hidden-filter-checkbox"></div>
                                <div class="hidden-filter-text">–í –ø—Ä–æ—Ü–µ—Å—Å–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞</div>
                            </div>
                            <div class="hidden-filter-option" data-status="notwatched">
                                <div class="hidden-filter-checkbox"></div>
                                <div class="hidden-filter-text">–ù–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–æ</div>
                            </div>
                        </div>
                    </div>
                    <div class="hidden-filter-group">
                        <span class="hidden-filter-label">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</span>
                        <div class="hidden-filter-options" id="categoryFilterOptions">
                            <!-- –ë—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–æ –∏–∑ localStorage -->
                        </div>
                    </div>
                </div>

                <!-- –†–∞—Å–∫—Ä—ã–≤–∞—é—â–∞—è—Å—è –ø–∞–Ω–µ–ª—å: –†–µ–π—Ç–∏–Ω–≥ -->
                <div class="filter-expanded" id="ratingExpanded">
                    <div class="filter-expanded-title">
                        <span>–†–µ–π—Ç–∏–Ω–≥</span>
                        <span class="filter-close" onclick="closeFilter('rating')">√ó</span>
                    </div>
                    <div class="rating-sort">
                        <button class="rating-sort-btn active" data-sort="desc">
                            <span class="material-symbols-outlined">arrow_downward</span>
                            <span>–ü–æ —É–±—ã–≤–∞–Ω–∏—é</span>
                        </button>
                        <button class="rating-sort-btn" data-sort="asc">
                            <span class="material-symbols-outlined">arrow_upward</span>
                            <span>–ü–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é</span>
                        </button>
                    </div>
                </div>

                <!-- –†–∞—Å–∫—Ä—ã–≤–∞—é—â–∞—è—Å—è –ø–∞–Ω–µ–ª—å: –ì–æ–¥ -->
                <div class="filter-expanded" id="yearExpanded">
                    <div class="filter-expanded-title">
                        <span>–ì–æ–¥ –≤—ã–ø—É—Å–∫–∞</span>
                        <span class="filter-close" onclick="closeFilter('year')">√ó</span>
                    </div>
                    <div class="year-range-container">
                        <div class="year-values">
                            <span id="yearMinValue">1900</span>
                            <span id="yearMaxValue">2025</span>
                        </div>
                        <div class="year-slider">
                            <div class="year-slider-track" id="yearTrack"></div>
                            <input type="range" id="yearMin" class="year-input" min="1900" max="2025" value="1900" step="1">
                            <input type="range" id="yearMax" class="year-input" min="1900" max="2025" value="2025" step="1">
                        </div>
                    </div>
                </div>

                <!-- –†–∞—Å–∫—Ä—ã–≤–∞—é—â–∞—è—Å—è –ø–∞–Ω–µ–ª—å: –°—Ç—Ä–∞–Ω–∞ -->
                <div class="filter-expanded" id="countryExpanded">
                    <div class="filter-expanded-title">
                        <span>–í—ã–±—Ä–∞—Ç—å —Å—Ç—Ä–∞–Ω—ã</span>
                        <span class="filter-close" onclick="closeFilter('country')">√ó</span>
                    </div>
                    <div class="dropdown" id="countryDropdown">
                        <div class="dropdown-trigger" id="countryTrigger">
                            <span>–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞</span>
                            <span class="material-symbols-outlined">expand_more</span>
                        </div>
                        <div class="dropdown-content" id="countryContent">
                            <!-- –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                        </div>
                    </div>
                </div>

                <!-- –†–∞—Å–∫—Ä—ã–≤–∞—é—â–∞—è—Å—è –ø–∞–Ω–µ–ª—å: –†–µ–∂–∏—Å—Å–µ—Ä -->
                <div class="filter-expanded" id="directorExpanded">
                    <div class="filter-expanded-title">
                        <span>–ü–æ–∏—Å–∫ –ø–æ —Ä–µ–∂–∏—Å—Å–µ—Ä—É</span>
                        <span class="filter-close" onclick="closeFilter('director')">√ó</span>
                    </div>
                    <div class="search-dropdown">
                        <input type="text" class="search-input" id="directorSearch" placeholder="–ù–∞—á–Ω–∏—Ç–µ –≤–≤–æ–¥–∏—Ç—å –∏–º—è...">
                        <div class="search-results" id="directorResults">
                            <!-- –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                        </div>
                    </div>
                </div>

                <!-- –†–∞—Å–∫—Ä—ã–≤–∞—é—â–∞—è—Å—è –ø–∞–Ω–µ–ª—å: –ñ–∞–Ω—Ä—ã -->
                <div class="filter-expanded" id="genreExpanded">
                    <div class="filter-expanded-title">
                        <span>–í—ã–±—Ä–∞—Ç—å –∂–∞–Ω—Ä—ã</span>
                        <span class="filter-close" onclick="closeFilter('genre')">√ó</span>
                    </div>
                    <div class="search-dropdown">
                        <input type="text" class="search-input" id="genreSearch" placeholder="–ü–æ–∏—Å–∫ –ø–æ –∂–∞–Ω—Ä–∞–º...">
                        <div class="dropdown-content" id="genreContent" style="display: none;">
                            <!-- –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- –¢–∞–±–ª–∏—Ü–∞ —Ñ–∏–ª—å–º–æ–≤ -->
            <div class="table-container">
                <table id="filmsTable">
                    <thead>
                        <tr>
                            <th>
                                <button class="toggle-panel-btn" onclick="toggleFilterPanel()" title="–°–∫—Ä—ã—Ç—å/–ø–æ–∫–∞–∑–∞—Ç—å –ø–∞–Ω–µ–ª—å —Ñ–∏–ª—å—Ç—Ä–æ–≤">
                                    <span class="material-symbols-outlined" id="togglePanelIcon">expand_less</span>
                                </button>
                            </th>
                            <th>–ù–∞–∑–≤–∞–Ω–∏–µ —Ñ–∏–ª—å–º–∞</th>
                            <th>–ú–æ–π —Ä–µ–π—Ç–∏–Ω–≥</th>
                            <th>–°—Ç—Ä–∞–Ω–∞</th>
                            <th>–ì–æ–¥</th>
                            <th>–†–µ–∂–∏—Å—Å–µ—Ä</th>
                        </tr>
                    </thead>
                    <tbody id="filmsTableBody">
                        <!-- –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∏–∑ API -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ —Å placeholder –∏ –∫–∞—Ä—Ç–æ—á–∫–æ–π -->
        <div>
            <div class="preview-placeholder" id="previewPlaceholder">
                –ù–∞–≤–µ–¥–∏—Ç–µ—Å—å –Ω–∞ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ñ–∏–ª—å–º–∞<br>–¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
            </div>
            <!-- –ü—Ä–µ–≤—å—é –∫–∞—Ä—Ç–æ—á–∫–∞ -->
    <div class="preview-card" id="previewCard">
        <div class="preview-poster" id="previewPoster">
            <img src="" alt="" id="previewPosterImg">
        </div>
        <div class="preview-title" id="previewTitle">–ù–∞–∑–≤–∞–Ω–∏–µ —Ñ–∏–ª—å–º–∞</div>
        <div class="preview-rating">
            <span class="preview-stars" id="previewStars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span>
            <span class="rating-value" id="previewRatingValue">0/10</span>
        </div>
        <div class="preview-info">
            <div class="preview-info-item">
                <span class="preview-info-label">–ì–æ–¥</span>
                <span class="preview-info-value" id="previewYear">‚Äî</span>
            </div>
            <div class="preview-info-item">
                <span class="preview-info-label">–°—Ç—Ä–∞–Ω–∞</span>
                <span class="preview-info-value" id="previewCountry">‚Äî</span>
            </div>
            <div class="preview-info-item">
                <span class="preview-info-label">–†–µ–∂–∏—Å—Å–µ—Ä</span>
                <span class="preview-info-value" id="previewDirector">‚Äî</span>
            </div>
            <div class="preview-info-item">
                <span class="preview-info-label">–ê–∫—Ç–µ—Ä—ã</span>
                <span class="preview-info-value" id="previewCast">‚Äî</span>
            </div>
            <div class="preview-info-item">
                <span class="preview-info-label">–ñ–∞–Ω—Ä—ã</span>
                <span class="preview-info-value" id="previewGenres">‚Äî</span>
            </div>
        </div>
        <div class="preview-description" id="previewDescription"></div>
        <button class="preview-action" onclick="openFilm()">–û—Ç–∫—Ä—ã—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É</button>
    </div>
        </div>
    </div>

    <script>
        let allFilms = [];
        let filteredFilms = [];
        let currentHoveredFilmId = null;
        let hoverTimeout = null;

        // –§–∏–ª—å—Ç—Ä—ã
        let filters = {
            ratingSort: 'desc',
            yearMin: 1900,
            yearMax: 2025,
            countries: [],
            director: '',
            genres: [],
            contentTypes: [], // movie, series
            watchStatus: [], // watched, notwatched
            categories: [] // –∏–∑ index2.html
        };

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å —Å–µ—Ä–≤–µ—Ä–∞
        async function loadFilms() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
            const pendingFiltersCheck = localStorage.getItem('pendingFilters');
            if (pendingFiltersCheck) {
                console.log('üìÇ [list_sorting.html] –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã:', JSON.parse(pendingFiltersCheck));
            } else {
                console.log('üìÇ [list_sorting.html] –°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤ –Ω–µ—Ç');
            }
            
            try {
                const response = await fetch('http://localhost:3000/api/films');
                if (!response.ok) {
                    throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö');
                }
                allFilms = await response.json();
                
                // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –¥–∞–Ω–Ω—ã–µ –∫ –Ω—É–∂–Ω–æ–º—É —Ñ–æ—Ä–º–∞—Ç—É
                allFilms = allFilms.map(film => ({
                    ...film,
                    personalRating: film.rating || 0,
                    yearNum: parseInt(film.year) || 0,
                    genres: []
                }));

                // –°–æ–±–∏—Ä–∞–µ–º –∂–∞–Ω—Ä—ã –∏–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
                allFilms.forEach(film => {
                    const genres = [];
                    if (film.mainCategory) genres.push(film.mainCategory);
                    if (film.subCategories && Array.isArray(film.subCategories)) {
                        genres.push(...film.subCategories);
                    }
                    film.genres = genres;
                });
                
                if (allFilms.length === 0) {
                    showEmptyState();
                } else {
                    await initializeFilters();
                    await applyPendingFilters(); // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã (–ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π!)
                    applyFilters();
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∏–ª—å–º–æ–≤:', error);
                showEmptyState();
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤
        async function initializeFilters() {
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –¥–∏–∞–ø–∞–∑–æ–Ω –ª–µ—Ç
            const years = allFilms.map(f => f.yearNum).filter(y => y > 0);
            if (years.length > 0) {
                filters.yearMin = Math.min(...years);
                filters.yearMax = Math.max(...years);
                document.getElementById('yearMin').min = filters.yearMin;
                document.getElementById('yearMin').max = filters.yearMax;
                document.getElementById('yearMin').value = filters.yearMin;
                document.getElementById('yearMax').min = filters.yearMin;
                document.getElementById('yearMax').max = filters.yearMax;
                document.getElementById('yearMax').value = filters.yearMax;
                updateYearDisplay();
            }

            // –°–æ–±–∏—Ä–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Å—Ç—Ä–∞–Ω—ã
            const countries = [...new Set(allFilms.map(f => f.country).filter(c => c))].sort();
            const countryContent = document.getElementById('countryContent');
            countryContent.innerHTML = countries.map(country => `
                <div class="dropdown-item" data-value="${country}">
                    <div class="dropdown-checkbox"></div>
                    <div class="dropdown-item-label">${country}</div>
                </div>
            `).join('');

            // –°–æ–±–∏—Ä–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Ä–µ–∂–∏—Å—Å–µ—Ä–æ–≤
            const directors = [...new Set(allFilms.map(f => f.director).filter(d => d))].sort();
            window.allDirectors = directors;

            // –ó–∞–≥—Ä—É–∂–∞–µ–º –∂–∞–Ω—Ä—ã/–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏–∑ API (categories.json)
            await loadGenres();

            // –ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏–∑ API –¥–ª—è —Å–∫—Ä—ã—Ç—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤
            await loadCategories();

            setupEventListeners();
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∂–∞–Ω—Ä–æ–≤ –∏–∑ API (categories.json) - –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–ñ–∞–Ω—Ä—ã"
        async function loadGenres() {
            try {
                const response = await fetch('http://localhost:3000/api/categories');
                if (!response.ok) {
                    throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∂–∞–Ω—Ä–æ–≤');
                }
                const categories = await response.json();
                
                if (categories.length === 0) {
                    return;
                }
                
                // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –≤ –º–∞—Å—Å–∏–≤ —Å—Ç—Ä–æ–∫ (–ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Å—Ç–∞—Ä–æ–≥–æ –∏ –Ω–æ–≤–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–æ–≤)
                const genres = categories.map(cat => typeof cat === 'string' ? cat : cat.name);
                
                // –°–æ—Ä—Ç–∏—Ä—É–µ–º –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Å–µ –∂–∞–Ω—Ä—ã –≥–ª–æ–±–∞–ª—å–Ω–æ
                genres.sort();
                window.allGenres = genres;
                
                // –†–µ–Ω–¥–µ—Ä–∏–º –∂–∞–Ω—Ä—ã
                renderGenres(genres);
                
                console.log('‚úì –ñ–∞–Ω—Ä—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ categories.json:', genres);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∂–∞–Ω—Ä–æ–≤:', error);
            }
        }

        // –†–µ–Ω–¥–µ—Ä –∂–∞–Ω—Ä–æ–≤
        function renderGenres(genres) {
            const genreContent = document.getElementById('genreContent');
            
            if (genres.length === 0) {
                genreContent.innerHTML = '<div style="color: #666; padding: 8px; font-size: 12px;">–ù–µ—Ç –∂–∞–Ω—Ä–æ–≤</div>';
                return;
            }
            
            genreContent.innerHTML = genres.map(genre => {
                const isSelected = filters.genres.includes(genre);
                return `
                    <div class="dropdown-item ${isSelected ? 'selected' : ''}" data-value="${genre}">
                        <div class="dropdown-checkbox">${isSelected ? '‚úì' : ''}</div>
                    <div class="dropdown-item-label">${genre}</div>
                </div>
                `;
            }).join('');

            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∂–∞–Ω—Ä–æ–≤
            genreContent.querySelectorAll('.dropdown-item').forEach(item => {
                item.addEventListener('click', function() {
                    const value = this.dataset.value;
                    const index = filters.genres.indexOf(value);
                    
                    if (index > -1) {
                        filters.genres.splice(index, 1);
                        this.classList.remove('selected');
                        this.querySelector('.dropdown-checkbox').textContent = '';
                    } else {
                        filters.genres.push(value);
                        this.classList.add('selected');
                        this.querySelector('.dropdown-checkbox').textContent = '‚úì';
                    }
                    
                    updateFilterBadges();
                    applyFilters();
                });
            });
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏–∑ API (categories.json) - –¥–ª—è —Å–∫—Ä—ã—Ç—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤
        async function loadCategories() {
            try {
                const response = await fetch('http://localhost:3000/api/categories');
                if (!response.ok) {
                    throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π');
                }
                const categoriesData = await response.json();
            const categoryOptions = document.getElementById('categoryFilterOptions');
            
                if (categoriesData.length === 0) {
                    categoryOptions.innerHTML = '<div style="color: #666; padding: 8px; font-size: 12px;">–ù–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–π</div>';
                    return;
                }
                
                // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ –º–∞—Å—Å–∏–≤ —Å—Ç—Ä–æ–∫ (–ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Å—Ç–∞—Ä–æ–≥–æ –∏ –Ω–æ–≤–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–æ–≤)
                const categories = categoriesData.map(cat => typeof cat === 'string' ? cat : cat.name);
                
                categoryOptions.innerHTML = categories.map(name => `
                    <div class="hidden-filter-option" data-category="${name}">
                    <div class="hidden-filter-checkbox"></div>
                        <div class="hidden-filter-text">${name}</div>
                </div>
            `).join('');

            // –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π
            categoryOptions.querySelectorAll('.hidden-filter-option').forEach(option => {
                option.addEventListener('click', function() {
                    const category = this.dataset.category;
                    const index = filters.categories.indexOf(category);
                    
                    if (index > -1) {
                        filters.categories.splice(index, 1);
                        this.classList.remove('selected');
                        this.querySelector('.hidden-filter-checkbox').textContent = '';
                    } else {
                        filters.categories.push(category);
                        this.classList.add('selected');
                        this.querySelector('.hidden-filter-checkbox').textContent = '‚úì';
                    }
                    
                        updatePageTitle(); // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
                        updateFilterBadges();
                    applyFilters();
                });
            });
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π:', error);
                const categoryOptions = document.getElementById('categoryFilterOptions');
                categoryOptions.innerHTML = '<div style="color: #666; padding: 8px; font-size: 12px;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</div>';
            }
        }

        // –û—Ç–∫—Ä—ã—Ç–∏–µ/–∑–∞–∫—Ä—ã—Ç–∏–µ –ø–∞–Ω–µ–ª–µ–π —Ñ–∏–ª—å—Ç—Ä–æ–≤
        function toggleFilter(filterName) {
            const expanded = document.getElementById(`${filterName}Expanded`);
            const toggle = document.getElementById(`toggle${filterName.charAt(0).toUpperCase() + filterName.slice(1)}`);
            
            // –ó–∞–∫—Ä—ã—Ç—å –≤—Å–µ –¥—Ä—É–≥–∏–µ –ø–∞–Ω–µ–ª–∏
            document.querySelectorAll('.filter-expanded').forEach(panel => {
                if (panel.id !== `${filterName}Expanded`) {
                    panel.classList.remove('show');
                }
            });
            document.querySelectorAll('.filter-toggle').forEach(btn => {
                if (btn.id !== `toggle${filterName.charAt(0).toUpperCase() + filterName.slice(1)}`) {
                    btn.classList.remove('active');
                }
            });
            
            // –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–∫—É—â—É—é –ø–∞–Ω–µ–ª—å
            expanded.classList.toggle('show');
            toggle.classList.toggle('active');
        }

        function closeFilter(filterName) {
            const expanded = document.getElementById(`${filterName}Expanded`);
            const toggle = document.getElementById(`toggle${filterName.charAt(0).toUpperCase() + filterName.slice(1)}`);
            expanded.classList.remove('show');
            toggle.classList.remove('active');
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        function updatePageTitle() {
            const pageTitle = document.getElementById('pageTitle');
            const pageTitle2 = document.getElementById('pageTitle2');
            
            let titleText;
            if (filters.categories.length === 1) {
                // –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–∞ –æ–¥–Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—è - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –µ—ë –Ω–∞–∑–≤–∞–Ω–∏–µ
                titleText = filters.categories[0];
            } else if (filters.categories.length > 1) {
                // –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–π - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏—Ö —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é
                titleText = filters.categories.join(', ');
            } else {
                // –ï—Å–ª–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –Ω–µ—Ç - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º "–û–±—â–∏–π —Å–ø–∏—Å–æ–∫"
                titleText = '–û–±—â–∏–π —Å–ø–∏—Å–æ–∫';
            }
            
            pageTitle.textContent = titleText;
            pageTitle2.textContent = titleText;
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–µ–π–¥–∂–µ–π –Ω–∞ –∫–Ω–æ–ø–∫–∞—Ö
        function updateFilterBadges() {
            // –°—Ç—Ä–∞–Ω—ã
            const countryBadge = document.getElementById('countryBadge');
            if (filters.countries.length > 0) {
                countryBadge.textContent = filters.countries.length;
                countryBadge.style.display = 'inline-block';
            } else {
                countryBadge.style.display = 'none';
            }

            // –ñ–∞–Ω—Ä—ã
            const genreBadge = document.getElementById('genreBadge');
            if (filters.genres.length > 0) {
                genreBadge.textContent = filters.genres.length;
                genreBadge.style.display = 'inline-block';
            } else {
                genreBadge.style.display = 'none';
            }

            // –°–∫—Ä—ã—Ç—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã (—Ç–∏–ø –∫–æ–Ω—Ç–µ–Ω—Ç–∞, —Å—Ç–∞—Ç—É—Å –ø—Ä–æ—Å–º–æ—Ç—Ä–∞, –∫–∞—Ç–µ–≥–æ—Ä–∏–∏)
            const hiddenFiltersBadge = document.getElementById('hiddenFiltersBadge');
            const hiddenCount = filters.contentTypes.length + filters.watchStatus.length + filters.categories.length;
            if (hiddenCount > 0) {
                hiddenFiltersBadge.textContent = hiddenCount;
                hiddenFiltersBadge.style.display = 'inline-block';
            } else {
                hiddenFiltersBadge.style.display = 'none';
            }
        }

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
        function setupEventListeners() {
            // –ö–Ω–æ–ø–∫–∞ —Å–∫—Ä—ã—Ç—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤
            document.getElementById('toggleHiddenFilters').addEventListener('click', function() {
                const panel = document.getElementById('hiddenFiltersPanel');
                panel.classList.toggle('show');
                this.classList.toggle('active');
            });

            // –°–∫—Ä—ã—Ç—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã: –¢–∏–ø –∫–æ–Ω—Ç–µ–Ω—Ç–∞
            document.querySelectorAll('[data-type]').forEach(option => {
                option.addEventListener('click', function() {
                    const type = this.dataset.type;
                    const index = filters.contentTypes.indexOf(type);
                    
                    if (index > -1) {
                        filters.contentTypes.splice(index, 1);
                        this.classList.remove('selected');
                        this.querySelector('.hidden-filter-checkbox').textContent = '';
                    } else {
                        filters.contentTypes.push(type);
                        this.classList.add('selected');
                        this.querySelector('.hidden-filter-checkbox').textContent = '‚úì';
                    }
                    
                    updateFilterBadges();
                    applyFilters();
                });
            });

            // –°–∫—Ä—ã—Ç—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã: –°—Ç–∞—Ç—É—Å –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
            document.querySelectorAll('[data-status]').forEach(option => {
                option.addEventListener('click', function() {
                    const status = this.dataset.status;
                    const index = filters.watchStatus.indexOf(status);
                    
                    if (index > -1) {
                        filters.watchStatus.splice(index, 1);
                        this.classList.remove('selected');
                        this.querySelector('.hidden-filter-checkbox').textContent = '';
                    } else {
                        filters.watchStatus.push(status);
                        this.classList.add('selected');
                        this.querySelector('.hidden-filter-checkbox').textContent = '‚úì';
                    }
                    
                    updateFilterBadges();
                    applyFilters();
                });
            });

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤
            document.getElementById('toggleRating').addEventListener('click', () => toggleFilter('rating'));
            document.getElementById('toggleYear').addEventListener('click', () => toggleFilter('year'));
            document.getElementById('toggleCountry').addEventListener('click', () => toggleFilter('country'));
            document.getElementById('toggleDirector').addEventListener('click', () => toggleFilter('director'));
            document.getElementById('toggleGenre').addEventListener('click', () => toggleFilter('genre'));

            // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —Ä–µ–π—Ç–∏–Ω–≥—É
            document.querySelectorAll('.rating-sort-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.rating-sort-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    filters.ratingSort = this.dataset.sort;
                    applyFilters();
                });
            });

            // –ì–æ–¥ - range sliders
            const yearMin = document.getElementById('yearMin');
            const yearMax = document.getElementById('yearMax');
            
            yearMin.addEventListener('input', function() {
                if (parseInt(this.value) > parseInt(yearMax.value)) {
                    this.value = yearMax.value;
                }
                filters.yearMin = parseInt(this.value);
                updateYearDisplay();
                applyFilters();
            });

            yearMax.addEventListener('input', function() {
                if (parseInt(this.value) < parseInt(yearMin.value)) {
                    this.value = yearMin.value;
                }
                filters.yearMax = parseInt(this.value);
                updateYearDisplay();
                applyFilters();
            });

            // –°—Ç—Ä–∞–Ω—ã dropdown
            const countryTrigger = document.getElementById('countryTrigger');
            const countryContent = document.getElementById('countryContent');
            
            countryTrigger.addEventListener('click', () => {
                countryContent.classList.toggle('show');
                countryTrigger.classList.toggle('active');
            });

            countryContent.querySelectorAll('.dropdown-item').forEach(item => {
                item.addEventListener('click', function() {
                    const value = this.dataset.value;
                    const index = filters.countries.indexOf(value);
                    
                    if (index > -1) {
                        filters.countries.splice(index, 1);
                        this.classList.remove('selected');
                        this.querySelector('.dropdown-checkbox').textContent = '';
                    } else {
                        filters.countries.push(value);
                        this.classList.add('selected');
                        this.querySelector('.dropdown-checkbox').textContent = '‚úì';
                    }
                    
                    updateFilterBadges();
                    applyFilters();
                });
            });

            // –ü–æ–∏—Å–∫ –∂–∞–Ω—Ä–æ–≤
            const genreSearch = document.getElementById('genreSearch');
            const genreContent = document.getElementById('genreContent');
            
            genreSearch.addEventListener('input', function() {
                const query = this.value.toLowerCase().trim();
                
                if (query.length === 0) {
                    genreContent.style.display = 'none';
                    return;
                }

                const matches = window.allGenres.filter(g => 
                    g.toLowerCase().includes(query)
                );
                    
                if (matches.length > 0) {
                    renderGenres(matches);
                    genreContent.style.display = 'block';
                    } else {
                    genreContent.innerHTML = '<div style="color: #666; padding: 8px; font-size: 12px;">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</div>';
                    genreContent.style.display = 'block';
                }
            });

            genreSearch.addEventListener('focus', function() {
                if (window.allGenres && window.allGenres.length > 0) {
                    const query = this.value.toLowerCase().trim();
                    if (query.length === 0) {
                        renderGenres(window.allGenres);
                    }
                    genreContent.style.display = 'block';
                }
            });

            // –ü–æ–∏—Å–∫ —Ä–µ–∂–∏—Å—Å–µ—Ä–∞
            const directorSearch = document.getElementById('directorSearch');
            const directorResults = document.getElementById('directorResults');
            
            directorSearch.addEventListener('input', function() {
                const query = this.value.toLowerCase().trim();
                
                if (query.length === 0) {
                    directorResults.classList.remove('show');
                    return;
                }

                const matches = window.allDirectors.filter(d => 
                    d.toLowerCase().includes(query)
                ).slice(0, 10);

                if (matches.length > 0) {
                    directorResults.innerHTML = matches.map(director => {
                        const isSelected = filters.director === director;
                        return `<div class="search-result-item ${isSelected ? 'selected' : ''}" data-value="${director}">${director}</div>`;
                    }).join('');
                    directorResults.classList.add('show');

                    directorResults.querySelectorAll('.search-result-item').forEach(item => {
                        item.addEventListener('click', function() {
                            const value = this.dataset.value;
                            if (filters.director === value) {
                                filters.director = '';
                                directorSearch.value = '';
                            } else {
                                filters.director = value;
                                directorSearch.value = value;
                            }
                            directorResults.classList.remove('show');
                            applyFilters();
                        });
                    });
                } else {
                    directorResults.classList.remove('show');
                }
            });

            directorSearch.addEventListener('focus', function() {
                if (this.value.trim().length > 0) {
                    directorResults.classList.add('show');
                }
            });

            // –ó–∞–∫—Ä—ã—Ç–∏–µ –≤—ã–ø–∞–¥–∞—é—â–∏—Ö —Å–ø–∏—Å–∫–æ–≤ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ
            document.addEventListener('click', function(e) {
                if (!e.target.closest('#countryDropdown')) {
                    countryContent.classList.remove('show');
                    countryTrigger.classList.remove('active');
                }
                if (!e.target.closest('.search-dropdown')) {
                    directorResults.classList.remove('show');
                    // –¢–∞–∫–∂–µ —Å–∫—Ä—ã–≤–∞–µ–º genreContent –µ—Å–ª–∏ –∫–ª–∏–∫ –≤–Ω–µ
                    if (!e.target.closest('#genreExpanded')) {
                        genreContent.style.display = 'none';
                    }
                }
            });
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–∏–∞–ø–∞–∑–æ–Ω–∞ –ª–µ—Ç
        function updateYearDisplay() {
            document.getElementById('yearMinValue').textContent = filters.yearMin;
            document.getElementById('yearMaxValue').textContent = filters.yearMax;
            
            const min = parseInt(document.getElementById('yearMin').min);
            const max = parseInt(document.getElementById('yearMin').max);
            const percentMin = ((filters.yearMin - min) / (max - min)) * 100;
            const percentMax = ((filters.yearMax - min) / (max - min)) * 100;
            
            const track = document.getElementById('yearTrack');
            track.style.left = percentMin + '%';
            track.style.width = (percentMax - percentMin) + '%';
        }

        // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤
        function applyFilters() {
            filteredFilms = allFilms.filter(film => {
                // –§–∏–ª—å—Ç—Ä –ø–æ –≥–æ–¥—É
                if (film.yearNum < filters.yearMin || film.yearNum > filters.yearMax) {
                    return false;
                }

                // –§–∏–ª—å—Ç—Ä –ø–æ —Å—Ç—Ä–∞–Ω–µ
                if (filters.countries.length > 0 && !filters.countries.includes(film.country)) {
                    return false;
                }

                // –§–∏–ª—å—Ç—Ä –ø–æ —Ä–µ–∂–∏—Å—Å–µ—Ä—É
                if (filters.director && film.director !== filters.director) {
                    return false;
                }

                // –§–∏–ª—å—Ç—Ä –ø–æ –∂–∞–Ω—Ä–∞–º
                if (filters.genres.length > 0) {
                    const hasGenre = filters.genres.some(genre => film.genres.includes(genre));
                    if (!hasGenre) return false;
                }

                // –§–∏–ª—å—Ç—Ä –ø–æ —Ç–∏–ø—É –∫–æ–Ω—Ç–µ–Ω—Ç–∞
                if (filters.contentTypes.length > 0) {
                    const filmType = film.contentType === 'series' ? 'series' : 'movie';
                    if (!filters.contentTypes.includes(filmType)) {
                        return false;
                    }
                }

                // –§–∏–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å—É –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
                if (filters.watchStatus.length > 0) {
                    // –õ–æ–≥–∏–∫–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ–π—Ç–∏–Ω–≥–∞ –∏ –ø–æ–ª—è watchStatus
                    const rating = film.personalRating || 0;
                    const filmWatchStatus = film.watchStatus;
                    
                    const matchesStatus = filters.watchStatus.some(status => {
                        if (status === 'notwatched') {
                            // –ù–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω = —Ä–µ–π—Ç–∏–Ω–≥ 0
                            return rating === 0;
                        } else if (status === 'watched') {
                            // –ü—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω = —Ä–µ–π—Ç–∏–Ω–≥ > 0 –∏ –Ω–µ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ
                            return rating > 0 && filmWatchStatus !== 'in-progress';
                        } else if (status === 'watching') {
                            // –í –ø—Ä–æ—Ü–µ—Å—Å–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
                            return filmWatchStatus === 'in-progress';
                        }
                        return false;
                    });
                    
                    if (!matchesStatus) return false;
                }

                // –§–∏–ª—å—Ç—Ä –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
                if (filters.categories.length > 0) {
                    const hasCategory = filters.categories.some(cat => 
                        film.mainCategory === cat || (film.subCategories && film.subCategories.includes(cat))
                    );
                    if (!hasCategory) return false;
                }

                return true;
            });

            // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —Ä–µ–π—Ç–∏–Ω–≥—É
            filteredFilms.sort((a, b) => {
                if (filters.ratingSort === 'desc') {
                    return b.personalRating - a.personalRating;
                } else {
                    return a.personalRating - b.personalRating;
                }
            });

            renderTable();
        }

        // –°–±—Ä–æ—Å –≤—Å–µ—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤
        function clearAllFilters() {
            // –°–±—Ä–æ—Å –∑–Ω–∞—á–µ–Ω–∏–π
            filters.ratingSort = 'desc';
            filters.yearMin = parseInt(document.getElementById('yearMin').min);
            filters.yearMax = parseInt(document.getElementById('yearMin').max);
            filters.countries = [];
            filters.director = '';
            filters.genres = [];
            filters.contentTypes = [];
            filters.watchStatus = [];
            filters.categories = [];

            // –°–±—Ä–æ—Å UI
            document.querySelectorAll('.rating-sort-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.rating-sort-btn[data-sort="desc"]').forEach(b => b.classList.add('active'));
            
            document.getElementById('yearMin').value = filters.yearMin;
            document.getElementById('yearMax').value = filters.yearMax;
            updateYearDisplay();

            document.querySelectorAll('.dropdown-item.selected').forEach(item => {
                item.classList.remove('selected');
                item.querySelector('.dropdown-checkbox').textContent = '';
            });

            // –°–±—Ä–æ—Å —Å–∫—Ä—ã—Ç—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤
            document.querySelectorAll('.hidden-filter-option.selected').forEach(item => {
                item.classList.remove('selected');
                item.querySelector('.hidden-filter-checkbox').textContent = '';
            });

            document.getElementById('directorSearch').value = '';

            // –ó–∞–∫—Ä—ã—Ç—å –≤—Å–µ –ø–∞–Ω–µ–ª–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤
            document.querySelectorAll('.filter-expanded').forEach(panel => {
                panel.classList.remove('show');
            });
            document.querySelectorAll('.filter-toggle').forEach(btn => {
                btn.classList.remove('active');
            });

            // –ó–∞–∫—Ä—ã—Ç—å —Å–∫—Ä—ã—Ç—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã
            document.getElementById('hiddenFiltersPanel').classList.remove('show');
            document.getElementById('toggleHiddenFilters').classList.remove('active');

            updatePageTitle(); // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ –ø—Ä–∏ —Å–±—Ä–æ—Å–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤
            updateFilterBadges();
            applyFilters();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–µ–π–¥–∂–µ–π –∏ –∑–∞–≥–æ–ª–æ–≤–∫–∞ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
        updatePageTitle();
        updateFilterBadges();

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—É—Å—Ç–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
        function showEmptyState() {
            const tbody = document.getElementById('filmsTableBody');
            tbody.innerHTML = `
                <tr>
                    <td colspan="6" class="empty-state">
                        <div class="material-symbols-outlined">movie</div>
                        <div class="empty-state-text">–§–∏–ª—å–º–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</div>
                        <div class="empty-state-hint">–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—ã–π —Ñ–∏–ª—å–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</div>
                    </td>
                </tr>
            `;
        }

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Ç–∞–±–ª–∏—Ü—ã
        function renderTable() {
            const tbody = document.getElementById('filmsTableBody');
            
            if (filteredFilms.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" class="empty-state">
                            <div class="material-symbols-outlined">search_off</div>
                            <div class="empty-state-text">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</div>
                            <div class="empty-state-hint">–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</div>
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = '';

            filteredFilms.forEach((film, index) => {
                const tr = document.createElement('tr');
                tr.dataset.filmId = film.id;
                
                // –ù–æ–º–µ—Ä
                const tdNum = document.createElement('td');
                tdNum.textContent = index + 1;
                tr.appendChild(tdNum);

                // –ù–∞–∑–≤–∞–Ω–∏–µ
                const tdTitle = document.createElement('td');
                tdTitle.textContent = film.title || '‚Äî';
                tr.appendChild(tdTitle);

                // –†–µ–π—Ç–∏–Ω–≥
                const tdRating = document.createElement('td');
                const ratingDiv = document.createElement('div');
                ratingDiv.className = 'rating-cell';
                const rating = film.personalRating || 0;
                const fullStars = Math.floor(rating / 2);
                const halfStar = rating % 2 !== 0;
                let starsHtml = '‚òÖ'.repeat(fullStars);
                if (halfStar) starsHtml += '‚òÜ';
                starsHtml += '‚òÜ'.repeat(5 - fullStars - (halfStar ? 1 : 0));
                ratingDiv.innerHTML = `
                    <span class="rating-stars">${starsHtml}</span>
                    <span class="rating-value">${rating}/10</span>
                `;
                tdRating.appendChild(ratingDiv);
                tr.appendChild(tdRating);

                // –°—Ç—Ä–∞–Ω–∞
                const tdCountry = document.createElement('td');
                tdCountry.textContent = film.country || '‚Äî';
                tr.appendChild(tdCountry);

                // –ì–æ–¥
                const tdYear = document.createElement('td');
                tdYear.textContent = film.year || '‚Äî';
                tr.appendChild(tdYear);

                // –†–µ–∂–∏—Å—Å–µ—Ä
                const tdDirector = document.createElement('td');
                tdDirector.textContent = film.director || '‚Äî';
                tr.appendChild(tdDirector);

                // –°–æ–±—ã—Ç–∏—è –Ω–∞–≤–µ–¥–µ–Ω–∏—è
                tr.addEventListener('mouseenter', () => handleRowHover(film, tr));
                tr.addEventListener('mouseleave', handleRowLeave);
                tr.addEventListener('click', () => openFilmById(film.id));

                tbody.appendChild(tr);
            });
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–≤–µ–¥–µ–Ω–∏—è –Ω–∞ —Å—Ç—Ä–æ–∫—É
        function handleRowHover(film, row) {
            clearTimeout(hoverTimeout);
            hoverTimeout = setTimeout(() => {
                showPreview(film);
                document.querySelectorAll('tbody tr').forEach(tr => tr.classList.remove('active'));
                row.classList.add('active');
            }, 300);
        }

        function handleRowLeave() {
            clearTimeout(hoverTimeout);
            hoverTimeout = setTimeout(() => {
                hidePreview();
                document.querySelectorAll('tbody tr').forEach(tr => tr.classList.remove('active'));
            }, 200);
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–µ–≤—å—é
        function showPreview(film) {
            currentHoveredFilmId = film.id;
            const card = document.getElementById('previewCard');
            const placeholder = document.getElementById('previewPlaceholder');
            
            // –°–∫—Ä—ã—Ç—å placeholder, –ø–æ–∫–∞–∑–∞—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É
            placeholder.classList.add('hide');
            
            // –ü–æ—Å—Ç–µ—Ä
            const posterImg = document.getElementById('previewPosterImg');
            if (film.bannerUrl) {
                const imagePath = film.bannerUrl.replace(/\\/g, '/');
                posterImg.src = `http://localhost:3000/${imagePath}`;
                posterImg.style.display = 'block';
            } else {
                posterImg.style.display = 'none';
            }

            // –ù–∞–∑–≤–∞–Ω–∏–µ
            document.getElementById('previewTitle').textContent = film.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è';

            // –†–µ–π—Ç–∏–Ω–≥
            const rating = film.personalRating || 0;
            const fullStars = Math.floor(rating / 2);
            const halfStar = rating % 2 !== 0;
            let starsHtml = '‚òÖ'.repeat(fullStars);
            if (halfStar) starsHtml += '‚òÜ';
            starsHtml += '‚òÜ'.repeat(5 - fullStars - (halfStar ? 1 : 0));
            document.getElementById('previewStars').textContent = starsHtml;
            document.getElementById('previewRatingValue').textContent = `${rating}/10`;

            // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
            document.getElementById('previewYear').textContent = film.year || '‚Äî';
            document.getElementById('previewCountry').textContent = film.country || '‚Äî';
            document.getElementById('previewDirector').textContent = film.director || '‚Äî';
            
            // –ê–∫—Ç–µ—Ä—Å–∫–∏–π —Å–æ—Å—Ç–∞–≤
            const cast = film.cast || '';
            const castArray = cast.split(',').map(s => s.trim()).filter(s => s);
            const castPreview = castArray.length > 3 
                ? castArray.slice(0, 3).join(', ') + '...' 
                : cast || '‚Äî';
            document.getElementById('previewCast').textContent = castPreview;
            
            const genres = film.genres || [];
            document.getElementById('previewGenres').textContent = genres.length > 0 ? genres.join(', ') : '‚Äî';

            // –û–ø–∏—Å–∞–Ω–∏–µ
            const description = film.filmDescription || film.description || '–û–ø–∏—Å–∞–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç';
            document.getElementById('previewDescription').textContent = 
                description.length > 200 ? description.substring(0, 200) + '...' : description;

            card.classList.add('show');
        }

        function hidePreview() {
            const card = document.getElementById('previewCard');
            const placeholder = document.getElementById('previewPlaceholder');
            
            card.classList.remove('show');
            placeholder.classList.remove('hide');
            currentHoveredFilmId = null;
        }

        // –î–µ—Ä–∂–∞—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É –æ—Ç–∫—Ä—ã—Ç–æ–π –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ –Ω–∞ –Ω–µ—ë
        document.getElementById('previewCard').addEventListener('mouseenter', () => {
            clearTimeout(hoverTimeout);
        });

        document.getElementById('previewCard').addEventListener('mouseleave', () => {
            hidePreview();
        });

        // –û—Ç–∫—Ä—ã—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É —Ñ–∏–ª—å–º–∞
        function openFilm() {
            if (currentHoveredFilmId) {
                openFilmById(currentHoveredFilmId);
            }
        }

        function openFilmById(filmId) {
            window.location.href = `edit-film.html?id=${filmId}`;
        }

        // –ö–Ω–æ–ø–∫–∞ –Ω–∞–∑–∞–¥
        function goBack() {
            window.location.href = 'index2.html';
        }

        // –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∫–∞—Ä—Ç–æ—á–∫—É
        function createNewFilm() {
            window.location.href = 'edit-film.html';
        }

        // –°–∫—Ä—ã—Ç—å/–ø–æ–∫–∞–∑–∞—Ç—å –ø–∞–Ω–µ–ª—å —Ñ–∏–ª—å—Ç—Ä–æ–≤
        function toggleFilterPanel() {
            const filterPanel = document.querySelector('.filter-panel');
            const icon = document.getElementById('togglePanelIcon');
            
            filterPanel.classList.toggle('hidden');
            
            // –ú–µ–Ω—è–µ–º –∏–∫–æ–Ω–∫—É
            if (filterPanel.classList.contains('hidden')) {
                icon.textContent = 'expand_more'; // –°—Ç—Ä–µ–ª–∫–∞ –≤–Ω–∏–∑ (–ø–æ–∫–∞–∑–∞—Ç—å –ø–∞–Ω–µ–ª—å)
            } else {
                icon.textContent = 'expand_less'; // –°—Ç—Ä–µ–ª–∫–∞ –≤–≤–µ—Ä—Ö (—Å–∫—Ä—ã—Ç—å –ø–∞–Ω–µ–ª—å)
            }
        }

        // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤ –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —Å—Ç—Ä–∞–Ω–∏—Ü
        async function applyPendingFilters() {
            const pendingFiltersStr = localStorage.getItem('pendingFilters');
            if (!pendingFiltersStr) return;
            
            try {
                const pendingFilters = JSON.parse(pendingFiltersStr);
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ñ–∏–ª—å—Ç—Ä—ã –Ω–µ —Å—Ç–∞—Ä—à–µ 5 –º–∏–Ω—É—Ç
                if (pendingFilters.timestamp && (Date.now() - pendingFilters.timestamp) > 300000) {
                    localStorage.removeItem('pendingFilters');
                    return;
                }
                
                console.log('üîÑ –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤:', pendingFilters);
                
                // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞, —á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ DOM –∑–∞–≥—Ä—É–∂–µ–Ω
                await new Promise(resolve => setTimeout(resolve, 100));
                
                // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ç–∏–ø –∫–æ–Ω—Ç–µ–Ω—Ç–∞ (movie/series)
                if (pendingFilters.contentType) {
                    const contentType = pendingFilters.contentType;
                    filters.contentTypes.push(contentType);
                    
                    // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º UI —ç–ª–µ–º–µ–Ω—Ç
                    const typeOption = document.querySelector(`[data-type="${contentType}"]`);
                    if (typeOption) {
                        typeOption.classList.add('selected');
                        typeOption.querySelector('.hidden-filter-checkbox').textContent = '‚úì';
                        console.log('‚úì –ü—Ä–∏–º–µ–Ω–µ–Ω —Ç–∏–ø –∫–æ–Ω—Ç–µ–Ω—Ç–∞:', contentType);
                    } else {
                        console.warn('‚ö†Ô∏è –ù–µ –Ω–∞–π–¥–µ–Ω —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è —Ç–∏–ø–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞:', contentType);
                    }
                }
                
                // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å—Ç–∞—Ç—É—Å –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ (watched/watching/notwatched)
                if (pendingFilters.watchStatus) {
                    const watchStatus = pendingFilters.watchStatus;
                    filters.watchStatus.push(watchStatus);
                    
                    // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º UI —ç–ª–µ–º–µ–Ω—Ç
                    const statusOption = document.querySelector(`[data-status="${watchStatus}"]`);
                    if (statusOption) {
                        statusOption.classList.add('selected');
                        statusOption.querySelector('.hidden-filter-checkbox').textContent = '‚úì';
                        console.log('‚úì –ü—Ä–∏–º–µ–Ω–µ–Ω —Å—Ç–∞—Ç—É—Å –ø—Ä–æ—Å–º–æ—Ç—Ä–∞:', watchStatus);
                    } else {
                        console.warn('‚ö†Ô∏è –ù–µ –Ω–∞–π–¥–µ–Ω —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞:', watchStatus);
                    }
                }
                
                // –ü—Ä–∏–º–µ–Ω—è–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏—é
                if (pendingFilters.category) {
                    const category = pendingFilters.category;
                    filters.categories.push(category);
                    
                    // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º UI —ç–ª–µ–º–µ–Ω—Ç
                    const categoryOption = document.querySelector(`[data-category="${category}"]`);
                    if (categoryOption) {
                        categoryOption.classList.add('selected');
                        categoryOption.querySelector('.hidden-filter-checkbox').textContent = '‚úì';
                        console.log('‚úì –ü—Ä–∏–º–µ–Ω–µ–Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—è:', category);
                    } else {
                        console.warn('‚ö†Ô∏è –ù–µ –Ω–∞–π–¥–µ–Ω —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:', category);
                    }
                }
                
                // –ù–ï –æ—Ç–∫—Ä—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, —Ç–æ–ª—å–∫–æ –ø—Ä–∏–º–µ–Ω—è–µ–º —Ñ–∏–ª—å—Ç—Ä—ã
                // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –æ—Ç–∫—Ä—ã—Ç—å –ø–∞–Ω–µ–ª—å –≤—Ä—É—á–Ω—É—é, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –∫–∞–∫–∏–µ —Ñ–∏–ª—å—Ç—Ä—ã –ø—Ä–∏–º–µ–Ω–µ–Ω—ã
                console.log('‚úì –ü–∞–Ω–µ–ª—å —Å–∫—Ä—ã—Ç—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤ –Ω–µ –æ—Ç–∫—Ä—ã—Ç–∞ (—Ñ–∏–ª—å—Ç—Ä—ã –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –≤ —Ñ–æ–Ω–µ)');
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –±–µ–π–¥–∂–∏ –∏ –∑–∞–≥–æ–ª–æ–≤–æ–∫
                updatePageTitle();
                updateFilterBadges();
                
                console.log('‚úÖ –§–∏–ª—å—Ç—Ä—ã —É—Å–ø–µ—à–Ω–æ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã');
                
                // –û—á–∏—â–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã –ø–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è
                localStorage.removeItem('pendingFilters');
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤:', error);
                localStorage.removeItem('pendingFilters');
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        loadFilms();
    </script>
    <script src="theme-manager.js"></script>
</body>
</html>
